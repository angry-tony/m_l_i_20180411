classes:
- system.docker.client
# PostgreSQL
- system.postgresql.client.pushkin
- system.postgresql.client.rundeck
- system.postgresql.client.alertmanager
- system.postgresql.client.security_monkey
- system.postgresql.client.janitor_monkey

# Elasticsearch
- system.elasticsearch.client
- system.elasticsearch.client.index.pushkin
- system.elasticsearch.client.index.cis_openstack

# DevOps Portal
- service.devops_portal.config
# Rundeck
- system.rundeck.server.docker
- system.rundeck.client
- system.rundeck.client.project.cicd
# OSS Tooling
- system.docker.swarm.stack.devops_portal
- system.docker.swarm.stack.hce
- system.docker.swarm.stack.postgresql
- system.docker.swarm.stack.pushkin
- system.docker.swarm.stack.rundeck
- system.docker.swarm.stack.security_monkey
- system.docker.swarm.stack.janitor_monkey

# Docker networks
- system.docker.swarm.network.oss_backend

# DevOps Portal services
- system.devops_portal.service.elasticsearch
- system.devops_portal.service.gerrit
- system.devops_portal.service.jenkins
- system.devops_portal.service.pushkin
- system.devops_portal.service.rundeck
- system.devops_portal.service.hce
- system.devops_portal.service.stacklight-grafana
- system.devops_portal.service.stacklight-kibana
- system.devops_portal.service.stacklight-prometheus
- system.devops_portal.service.grafana
- system.devops_portal.service.security_monkey
- system.devops_portal.service.janitor_monkey
- cluster.vlab.infra

parameters:
  _param:
    docker_image_devops_portal: docker-prod-local.artifactory.mirantis.com/mirantis/oss/devops-portal:${_param:apt_mk_version}
    docker_image_elasticsearch: docker-prod-local.artifactory.mirantis.com/mirantis/external/elasticsearch:${_param:apt_mk_version}
    docker_image_janitor_monkey: docker-prod-local.artifactory.mirantis.com/mirantis/oss/janitor-monkey:${_param:apt_mk_version}
    docker_image_mongodb: docker-prod-local.artifactory.mirantis.com/mirantis/external/mongo:${_param:apt_mk_version}
    docker_image_postgresql: docker-prod-local.artifactory.mirantis.com/mirantis/external/postgres:${_param:apt_mk_version}
    docker_image_pushkin: docker-prod-local.artifactory.mirantis.com/mirantis/oss/pushkin:${_param:apt_mk_version}
    docker_image_rundeck: docker-prod-local.artifactory.mirantis.com/mirantis/oss/rundeck:${_param:apt_mk_version}
    docker_image_security_monkey_api: docker-prod-local.artifactory.mirantis.com/mirantis/oss/security-monkey-api:${_param:apt_mk_version}
    docker_image_security_monkey_scheduler: docker-prod-local.artifactory.mirantis.com/mirantis/oss/security-monkey-scheduler:${_param:apt_mk_version}
    docker_image_hce: docker-prod-local.artifactory.mirantis.com/mirantis/oss/hce:${_param:apt_mk_version}
    # PostgreSQL
    postgresql_admin_user_password: rd4kIJgEkoVujIJo
    postgresql_client_user: ${_param:postgresql_admin_user}
    postgresql_client_password: ${_param:postgresql_admin_user_password}
    postgresql_client_host: ${_param:haproxy_postgresql_bind_host}
    postgresql_client_port: ${_param:haproxy_postgresql_bind_port}
    # HCE
    hce_elasticsearch_host: ${_param:elasticsearch_bind_host}
    hce_elasticsearch_port: ${_param:elasticsearch_http_bind_port}
    hce_prometheus_host: ${_param:stacklight_monitor_address}
    hce_prometheus_port: ${_param:stacklight_prometheus_port}

    # Pushkin
    pushkin_db_user: pushkin
    pushkin_db_user_password: QKzr02Ckn0DzJTWA
    pushkin_db_host: ${_param:haproxy_postgresql_bind_host}
    pushkin_smtp_host: 
    pushkin_smtp_port: 
    pushkin_email_sender_password: 
    #..WebHook notification senders
    webhook_from: 
    webhook_recipients: 
    webhook_login_id: 13
    webhook_application_id: 24

    # OSS OpenStack
    oss_openstack_username: admin
    oss_openstack_password: nova
    oss_openstack_http_prefix: http
    oss_openstack_endpoint_address: ${_param:cluster_public_host}
    oss_openstack_auth_url: ${_param:oss_openstack_http_prefix}://${_param:oss_openstack_endpoint_address}:5000/v3
    oss_openstack_project: admin
    oss_openstack_domain_id: default
    oss_openstack_username_domain_id: default
    oss_openstack_ssl_verify: False
    oss_openstack_endpoint_type: public
    oss_openstack_credentials_path: /srv/volumes/rundeck/storage
    oss_openstack_cert: |
            -----BEGIN CERTIFICATE----- MIIE0DCCA7igAwIBAgIBBzANBgkqhkiG9w0BAQsFADCBgzELMAkGA1UEBhMCVVMx EDAOBgNVBAgTB0FyaXpvbmExEzARBgNVBAcTClNjb3R0c2RhbGUxGjAYBgNVBAoT AAGjggEaMIIBFjAPBgNVHRMBAf8EBTADAQH/MA4GA1UdDwEB/wQEAwIBBjAdBgNV 91cxG7685C/b+LrTW+C05+Z5Yg4MotdqY3MxtfWoSKQ7CC2iXZDXtHwlTxFWMMS2 -----END CERTIFICATE----- -----BEGIN CERTIFICATE----- dGhvcml0eSAtIEcyMIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAv3Fi 9kIDN0zmiN/VryTyscPfzLXs4Jlet0lUIDyUGAzHHFIYSaRt4bNYC8...
    # SecurityMonkey
    secmonkey_db_user: secmonkey
    secmonkey_db_user_password: nOAdMG5gMYp8tJG7
    secmonkey_db_host: ${_param:postgresql_bind_host}
    security_monkey_openstack:
      username: ${_param:oss_openstack_username}
      password: ${_param:oss_openstack_password}
      auth_url: ${_param:oss_openstack_auth_url}
      user_domain_name: ${_param:oss_openstack_domain_id}
      project_domain_name: ${_param:oss_openstack_domain_id}
      ssl_verify: ${_param:oss_openstack_ssl_verify}
      endpoint_type: ${_param:oss_openstack_endpoint_type}
      source_credentials: ${_param:oss_openstack_credentials_path}
    # JanitorMonkey
    docker_mongodb_admin_username: admin
    docker_mongodb_admin_password: Jc2mkB5l47CYYu6H
    janitor_monkey_mongodb_host: ${_param:haproxy_mongodb_bind_host}
    janitor_monkey_openstack:
      username: ${_param:oss_openstack_username}
      password: ${_param:oss_openstack_password}
      auth_url: ${_param:oss_openstack_auth_url}
      project_name: ${_param:oss_openstack_project}
      project_domain_name: ${_param:oss_openstack_username_domain_id}
      ssl_verify: ${_param:oss_openstack_ssl_verify}
      endpoint_type: ${_param:oss_openstack_endpoint_type}
      source_credentials: ${_param:oss_openstack_credentials_path}

    # Rundeck DB support

    rundeck_runbook_public_key: ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQCVSYNYKIqnBhDxXH+hZT1vkkADD2TkpXcfbgKMqq2SyWjKKiHFuy92D38S91KGHC/aP3eLBz0GdNFozuS36AIa2WOlr6Y2UpwUUaieKYvJ2UrOp0Tpr2rL1fOmsvWQ8JaraLfDm99rLkM+l4dLvspZROhV4/8iPhaYpmpCPa0MtHHaZY40jggo3ViQja2nZodFQEwkcD0B9aBOb2J1xi6LUAWLD02YUQegX18FjVz0VVYsa9ipK6d1+nfIMqelduEbGGp2z3WeJxkSpI3XXnToRETgPmVy8hvhX54brfNqNcL6yt9EYF0GdcXeL+b0SxX4YKyG6nSSSLSESTYxexmR
    rundeck_runbook_private_key: |
      -----BEGIN RSA PRIVATE KEY-----
      MIIEowIBAAKCAQEAlUmDWCiKpwYQ8Vx/oWU9b5JAAw9k5KV3H24CjKqtksloyioh
      xbsvdg9/EvdShhwv2j93iwc9BnTRaM7kt+gCGtljpa+mNlKcFFGonimLydlKzqdE
      6a9qy9XzprL1kPCWq2i3w5vfay5DPpeHS77KWUToVeP/Ij4WmKZqQj2tDLRx2mWO
      NI4IKN1YkI2tp2aHRUBMJHA9AfWgTm9idcYui1AFiw9NmFEHoF9fBY1c9FVWLGvY
      qSundfp3yDKnpXbhGxhqds91nicZEqSN11506ERE4D5lcvIb4V+eG63zajXC+srf
      RGBdBnXF3i/m9EsV+GCshup0kki0hEk2MXsZkQIDAQABAoIBAQCEorracbK2sLIO
      72LKD3vlC+hpj5zRdJ2AxCnptp7egqnirEozNpr1ZtE9FZYxZwuw+aCJWlYCzXlc
      iC03pB9yoWBiTcv8Cat4dhC87SawoKlRL9YPVXYqQh3nJqr9KnSDOFfEqFF5FbJT
      AygGyS1Y4NsXrKj6UHWdDIXt8oQ0eyYjaTFiQthWQ4y/9VP5eis8BQnVlAld8Lo6
      9sz1qHUWQK0acAU0XW0rpVk+uG1I6eM4ngZ67YwS59MfeUpQzLl5LRtCBbV84uIX
      Ltg4jdN5zRNySxQ1m6IGSkfXCiDrPNpZ+LJu38+P80iwDT2QT2gFEh6FJJTiTWmy
      VrNncpctAoGBAMVN2eKnMX5VcbPar8dpBoATLLK8sy0g2BG3g2Hy9Qmv+WBG/bRH
      RMOPG7Xi/2mQWPNN/4c8WVWuCY3kZP86dMEelBC13ntZZWE3NyIG2XsSK2pbX+9N
      TvfZp3H/3UXHfi+ydvlNRvvaarLEnktJFmZ6kdGc+KU3DYaQkY43FzUfAoGBAMGy
      0iBWMk550q1lVY2CGpgWsqRYeoG6otj3yq48VV42JqafumzKabMkeH/UKREQ5yDM
      k4fho4Nt/wSLiAISoeHqdAmQVBMMrTeOQSMP/iQsNMi08p8+R+QnChNin08mwICQ
      CSwSF9We/h+1Mw6KVAk+4ivPU8LrP7L+aZ0OaqtPAoGAOLjl7/QzFWfJFXTEXibC
      eKWKjyQSuuGbXJSOj+VCLvPJVLV0EJUAntwQklzdIuMdv2zoDl/6Ktiq5IEJzBpp
      IHADDz7J5FpR+/3cusqPUYNqudvlG631Cuom6m4tlfcBPwMmkwt1YchsLlK6U1iC
      uRl5vHJNRWorWElNnz4VTO8CgYAFqnJlCcBs9TlJYyZufjjC7B8LmZ7zvn7W8+CU
      2iTxHYph41gzqHQRDmcL7ivJWQI5vmIuXlZHGOeVvXMcBGmBzzbXtMYQzJUgg+O5
      39TiP/zHRiu2pr65mL69tGvOh+annA74oArcb8slKEq3CSrOHm3FNEpR8Emrta9n
      La3HFwKBgEbd5xlLHliqlGUVaaFAx153emsGR2RPyI3ELxyTPCK5NoAO8YYkFwsu
      adKE+0WRP6khgT333784Yo0HgX3HMYCFSUpa3DTUdhTfZmUB9OCzp04rjyCjumut
      oSUoJrhccAfEsRTQ2TCQiuM0MOTQCpbp/hvP8PhdiHB29X426ZY1
      -----END RSA PRIVATE KEY-----
    # CIS
    rundeck_cis_enabled: True
    rundeck_cis_jobs_repository: https://github.com/Mirantis/rundeck-cis-jobs.git
    rundeck_cis_jobs_revision: master
    rundeck_cis_openstack:
      auth_url: ${_param:oss_openstack_auth_url}/auth/tokens
      endpoint_type: ${_param:oss_openstack_endpoint_type}URL
      username: ${_param:oss_openstack_username}
      password: ${_param:oss_openstack_password}
      project_name: ${_param:oss_openstack_project}
      domain_id: ${_param:oss_openstack_domain_id}
      cert: ${_param:oss_openstack_cert}
      ssl_cert_file: cert.pem
    rundeck_cis_os_docker_image: docker-prod-local.artifactory.mirantis.com/mirantis/oss/cis-openstack:latest

    # In case of using DOP through external proxy address
    rundeck_forward_iframe: False
    rundeck_iframe_host: ${_param:openstack_proxy_address}
    rundeck_iframe_port: ${_param:haproxy_rundeck_exposed_port}
    rundeck_iframe_ssl: False

    elasticsearch_http_bind_port: 9200
    oss_jenkins_password: ${_param:jenkins_admin_password}
    #TODO: set password for CICD gerrit login
    # Switch to generic ElasticSearch
    haproxy_elasticsearch_bind_host: ${_param:stacklight_monitor_address}
    haproxy_elasticsearch_http_bind_port: 9200
    elasticsearch_bind_host: ${_param:stacklight_monitor_address}
    elasticsearch_binary_bind_port: 9300
    elasticsearch_cluster_name: elasticsearch
    rundeck_cis_elasticsearch_url: http://${_param:stacklight_monitor_address}:9200


  devops_portal:
    config:
      service:
        elasticsearch:
          resolve_hostname: false
