
classes:
  # Services
  - system.docker.client
  # Docker services
  - system.docker.swarm.stack.docker
  - system.docker.swarm.stack.gerrit
  - system.docker.swarm.stack.jenkins
  - system.docker.swarm.stack.ldap

  # Jenkins
  - system.jenkins.master.config
  - system.jenkins.client
  - system.jenkins.client.credential.gerrit
  - system.jenkins.client.credential.salt
  # Jobs
  - system.jenkins.client.job.git-mirrors.downstream.pipelines
  - system.jenkins.client.job.deploy.openstack
  - system.jenkins.client.job.deploy.update
  - system.jenkins.client.job.ceph
  # Security
  - system.jenkins.client.security.ldap
  - system.jenkins.client.security.matrix
  # Slaves
  - system.jenkins.client.node
  # OpenLDAP
  - system.openldap.client
  - system.openldap.client.people.admin

  # Gerrit
  - system.gerrit.client
  - system.gerrit.client.project.ci

  - system.docker.swarm.master

  - cluster.deployment_name.infra
  - cluster.deployment_name.cicd.control

parameters:
  _param:
    # Jenkins
    jenkins_slave_user: admin
    jenkins_client_user: admin
    jenkins_slave_password: ${_param:jenkins_admin_password}
    jenkins_client_password: ${_param:jenkins_admin_password}
    jenkins_admin_email: ${_param:admin_email}
    aptly_api_port: 8080
    aptly_public_port: 80
    jenkins_admin_public_key: ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQC4qrZO8zbHXtRNSJ2mOqp2HvivJNI2hLy1B6A14E2p9DRX50o229shd3lE/+exoNOuzeLUblMiADoZGkq4iLDyKXNiZcL4gE+s3QMSYXzfPktJmZGWYKWk9AOS1o9X1CAU4t7Z6gec5TB0aeD/rQ0TFY97TAWo16uAcE3UL7xdPJsuQs4Yi6tPp5o2fWAU4Yd0JQeQnQoDKodynimjA1rmbDllpg+IXHoFFU6SJaPjxvg28c4Do6/gUt/e8omgEM2Dhk0YI6GYCr5xuVGCGHWmPXwWKUi+aSVBlgQwcp0zdE3zH64lR5rAGegxClrR4ymUZ+fF5j9b1fLp/eXws5nB
    jenkins_admin_private_key: |
      -----BEGIN RSA PRIVATE KEY-----
      MIIEogIBAAKCAQEAuKq2TvM2x17UTUidpjqqdh74ryTSNoS8tQegNeBNqfQ0V+dK
      NtvbIXd5RP/nsaDTrs3i1G5TIgA6GRpKuIiw8ilzYmXC+IBPrN0DEmF83z5LSZmR
      lmClpPQDktaPV9QgFOLe2eoHnOUwdGng/60NExWPe0wFqNergHBN1C+8XTybLkLO
      GIurT6eaNn1gFOGHdCUHkJ0KAyqHcp4powNa5mw5ZaYPiFx6BRVOkiWj48b4NvHO
      A6Ov4FLf3vKJoBDNg4ZNGCOhmAq+cblRghh1pj18FilIvmklQZYEMHKdM3RN8x+u
      JUeawBnoMQpa0eMplGfnxeY/W9Xy6f3l8LOZwQIDAQABAoIBADQTJ9/xpAPq0PGO
      Ra6nooQ2zagOOR1YpyJhqSMoQp5nmA8l0P7RVuUEHPWBOKQVlzwXIR0Ik3bmG3wS
      tvl8ynEvkTMxQR70iANWO9SGG0GU/oQdwzllvbBbg1p4GOoKjpV1OKS44zayRsy9
      Qs62zRYRoWmCkaIAV4Obp8brQzIDN0vd4iOIP9QmHCZbaO7KiHki3QhsSvcBJqCb
      E8v2n6D2zK5MGwkABsdXaOqz0sLUVVziJ0OXOxyO3vNsiOn+DYywlhQmYe3STgpx
      MkuRukmq6muNGDl1jItPdmAbpMW+iSXDV3Qo0MRbaghuq6kWMY+yZeLcfpHU17P3
      VnKmIwECgYEA6WR9LnDWxWWV3V+lAvkSGYWD+Ef+wDX9qjXwA/tAhTlAsyH0zbmB
      pEPj9ypILo9x/ZYAMLEnLurwYgFWn1gqY7djpLMZgJJ8AmsDJNZxmucFh/Z8IFaC
      SUonEvK2qWBW18oTjhCykz+OWM9ik8EtG4YZ6Cg4LGp22vsfKEwMJtECgYEAyo30
      zb+/mcqubZXJwnYeiO80zbCvMj+z2ASnGstzt6MUbJTTsE3yWFGx4o/fmVXzinq4
      A/9MP0177kx883w0tiPC/Bs6uI96tNATZwveLn21lzKXWAyerRRJgSuIRaS4YnHY
      14tG2Wn2umTttyOGNvn04U3U1wc14E5L4B8D3/ECgYBTxVjVKXU9JugyrBjLR2EC
      vhSPMjAzB24EARYkJ7OR3enmIgL/MF1i+2dAmPGNnLkafxOUZpGc2oDrfHV9/iRA
      5Fski5BUwL84Evbu6vWd1tv6YDNPXB2pdq8tsuZzRvwEuihorn+aMI7EO7OzOvwY
      y/pShNUcxB3jHY2iZiFacQKBgHiGR2g19Hg6Vdf3DPqc9kZcr3rE6zpnFUgwXI5h
      CRX3/6ssU1nQx6ct1T8OhOnkbumzY9NdEa2JGXkOIjtvaJ4IYXlJaoNvPIBiX2kt
      cqMPQgIZpFxMBg7Ox34IvSlTfjN1sqVuxlWP67O1Yo1aof4MdV2qxj68l55EeHl/
      evrBAoGAFDf2tVTjwL7FGcUjJx9ISC/znT37qUdvIAKMgz1tigqSPGJ21pVSV0Jm
      28Y7FhddPvGYD9Ibmg//bj3sfZb9zfrxPLnHpErBr6eVzQ5lJf1TGqJUZgGxJghq
      pv0TQjTQZXQXwoN7Ke0NKY11HqWLjWMwHqeq321WC2HMnEr/Q48=
      -----END RSA PRIVATE KEY-----
    # Jobs params
    jenkins_gerrit_url: ssh://admin@${_param:haproxy_gerrit_bind_host}:${_param:haproxy_gerrit_ssh_bind_port}

    # Gerrit
    gerrit_admin_email: ${_param:admin_email}
    gerrit_public_host: https://${_param:nginx_proxy_gerrit_server_site_host}:${_param:nginx_proxy_gerrit_server_site_port}
    gerrit_admin_public_key: ${_param:jenkins_admin_public_key}
    gerrit_admin_private_key: ${_param:jenkins_admin_private_key}
    gerrit_auth_type: LDAP
    gerrit_ldap_server: "ldap://${_param:cluster_vip_address}"
    gerrit_ldap_bind_user: "cn=admin,${_param:openldap_dn}"
    gerrit_ldap_bind_password: ${_param:openldap_admin_password}
    gerrit_ldap_account_base: ou=people,${_param:openldap_dn}
    gerrit_ldap_group_base: ou=groups,${_param:openldap_dn}
  jenkins:
    client:
      lib:
        pipeline-library:
          branch: ${_param:jenkins_pipelines_branch}
